# Техническая документация: Модуль пользователей (`user/`)

---

## Назначение

Модули внутри папки `user/` реализуют **функциональность управления пользователями**, включая регистрацию, вход, работу с корзиной и бонусной системой.

---

## Структура

| Файл                  | Назначение                                                                 |
|-----------------------|---------------------------------------------------------------------------|
| `models.py`           | Класс `User` — модель пользователя, корзина, бонусная система, сериализация. |
| `routes.py`           | Маршруты Flask для регистрации, входа и выхода пользователя.              |
| `services.py`         | Класс `UserService` — логика работы с пользователями и JSON-хранилищем.   |
| `validators.py`       | Простая валидация регистрации (пароль, почта).                            |

---

## Класс: `User` (`models.py`)

Модель пользователя с атрибутами:
- `username`, `email`, `password`
- `bonus_card` — система баллов
- `cart` — словарь с товарами и их количеством

### Методы:

| Метод                  | Назначение                                                                |
|------------------------|---------------------------------------------------------------------------|
| `hash_password()`      | Хэширует пароль с помощью `bcrypt`.                                       |
| `add_to_cart()`        | Добавляет товар в корзину.                                                |
| `remove_from_cart()`   | Удаляет товар из корзины.                                                 |
| `update_cart_item()`   | Обновляет количество товара.                                              |
| `clear_cart()`         | Очищает корзину.                                                          |
| `get_cart_count()`     | Возвращает общее количество товаров.                                      |
| `to_dict()`            | Сериализация пользователя в словарь.                                      |
| `from_dict()`          | Десериализация из словаря в объект `User`.                                |

---

## Класс: `UserService` (`services.py`)

Инкапсулирует работу с JSON-файлом пользователей и проверку данных.

### Методы:

| Метод                      | Назначение                                                                 |
|----------------------------|----------------------------------------------------------------------------|
| `add_user()`               | Добавляет нового пользователя.                                             |
| `get_user()`               | Ищет пользователя по имени или email.                                      |
| `update_user()`            | Обновляет пользователя в JSON.                                             |
| `check_password()`         | Проверяет соответствие пароля (`bcrypt`).                                  |
| `is_email_taken()`         | Проверяет, занят ли email.                                                 |
| `add_bonus_points()`       | Добавляет баллы на бонусную карту.                                         |
| `minus_bonus_points()`     | Списывает баллы с бонусной карты.                                          |

---

## Маршруты Flask (`routes.py`)

### `/user/register` (GET, POST)
- Показывает форму регистрации.
- Обрабатывает ввод, проверяет совпадение паролей и наличие email.
- Добавляет пользователя в систему, сохраняет в JSON.

### `/user/login` (GET, POST)
- Показывает форму входа.
- Проверяет наличие пользователя и правильность пароля.
- Устанавливает `session['username']`.

### `/user/logout`
- Удаляет `session['username']`.
- Перенаправляет на главную страницу.

---

## Валидация (`validators.py`)

### Функция: `validate_registration()`

Проверяет:
- Совпадают ли пароли.
- Занят ли указанный email.

**Возвращает:** строку ошибки или `None`.

---


---

## Зависимости

- `bcrypt` — хэширование паролей
- `uuid` — генерация ID бонусной карты
- `Flask` — маршруты и сессии

---

